<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç–ø—É—Å–∫–æ–≤ –Ω–∞ –æ–∫—Ç—è–±—Ä—å 2025</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>


<!-- –ï–¥–∏–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü -->
<header class="main-header">
    <div class="header-container">
        <input type="checkbox" id="burger-checkbox" class="burger-checkbox">
        <label for="burger-checkbox" class="burger"></label>
        <div class="overlay"></div>
        <ul class="menu-list">
            <li><a href="/" class="menu-item">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></li>
            <li><a href="/personal_business" class="menu-item">–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –¥–µ–ª–∞</a></li>
            <li><a href="/list_employees" class="menu-item">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</a></li>
            <li><a href="/calendar_2025" class="menu-item">–ö–∞–ª–µ–Ω–¥–∞—Ä—å 2025</a></li>

            –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É:

            <li><a href="/forming_employee_report_card" class="menu-item">–ù–æ—è–±—Ä—å 2025</a></li>
            <li><a href="/forming_employee_report_card_12" class="menu-item">–î–µ–∫–∞–±—Ä—å 2025</a></li>

            –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:

            <li><a href="/report_card_10" class="menu-item">–û–∫—Ç—è–±—Ä—å 2025</a></li>
            <li><a href="/report_card_11" class="menu-item">–ù–æ—è–±—Ä—å 2025</a></li>
            <li><a href="/report_card_12" class="menu-item">–î–µ–∫–∞–±—Ä—å 2025</a></li>
        </ul>
    </div>
</header>

<div class="container">
    <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç–ø—É—Å–∫–æ–≤ –Ω–∞ –æ–∫—Ç—è–±—Ä—å 2025</h1>

    <button class="add-employee-btn" onclick="addEmployee()">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>

    <div id="employees-container"></div>

    <div class="summary">
        <h3>–°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <div id="summary-content"></div>
    </div>
</div>

<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const employees = [];
    const month = 9; // –û–∫—Ç—è–±—Ä—å (0-11)
    const year = 2025;

    // –ù–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ –∏ –º–µ—Å—è—Ü–µ–≤ (–Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞)
    const weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
    const months = [
        '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
        '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
    ];

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = function () {
        addEmployee(); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function addEmployee() {
        const employeeId = employees.length;
        const newEmployee = {
            id: employeeId,
            name: `–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä`,
            vacationStart: null,
            vacationEnd: null,
            weekends: [0, 6] // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        };

        employees.push(newEmployee);
        renderEmployeeSection(employeeId);
        updateCalendar();
    }

    //    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    async function saveEmployee(employeeId) {
        const employee = employees[employeeId];
        if (!employee.vacationStart || !employee.vacationEnd) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞—Ç—ã –æ—Ç–ø—É—Å–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º!");
            return;
        }

        try {
            const response = await fetch('/employees/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: employee.name,
                    vacation_start: employee.vacationStart,
                    vacation_end: employee.vacationEnd,
                    weekends: employee.weekends
                })
            });
            const data = await response.json();
            console.log('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω:', data);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function renderEmployeeSection(employeeId) {
        const employee = employees[employeeId];
        const container = document.getElementById('employees-container');

        const employeeDiv = document.createElement('div');
        employeeDiv.className = 'employee-section';
        employeeDiv.id = `employee-${employeeId}`;

        employeeDiv.innerHTML = `
                <div class="employee-header">
                    <div class="employee-name">
                        <input type="text" value="${employee.name}" onchange="updateEmployeeName(${employeeId}, this.value)">
                    </div>
                    <button onclick="saveEmployee(${employeeId})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button onclick="removeEmployee(${employeeId})">–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                </div>

                <div class="vacation-inputs">
                    <label>
                        –ù–∞—á–∞–ª–æ –æ—Ç–ø—É—Å–∫–∞:
                        <input type="date" onchange="updateVacation(${employeeId}, 'start', this.value)"
                               min="2025-10-01" max="2025-10-31">
                    </label>

                    <label>
                        –ö–æ–Ω–µ—Ü –æ—Ç–ø—É—Å–∫–∞:
                        <input type="date" onchange="updateVacation(${employeeId}, 'end', this.value)"
                               min="2025-10-01" max="2025-10-31">
                    </label>
                </div>

                <div class="custom-weekends">
                    <label>–í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏:</label>
                    <div class="weekend-selector">
                        ${weekdays.map((day, index) => {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é (0=–≤—Å, 1=–ø–Ω, ..., 6=—Å–±)
            const standardIndex = index === 6 ? 0 : index + 1;
            return `
                                <label>
                                    <input type="checkbox" ${employee.weekends.includes(standardIndex) ? 'checked' : ''}
                                           onchange="toggleWeekend(${employeeId}, ${standardIndex}, this.checked)">
                                    ${day}
                                </label>
                            `;
        }).join('')}
                    </div>
                </div>

                <div class="calendar-grid" id="calendar-${employeeId}">
                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∑–¥–µ—Å—å -->
                </div>
            `;

        container.appendChild(employeeDiv);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function updateEmployeeName(employeeId, name) {
        employees[employeeId].name = name;
        updateCalendar();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—É—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function updateVacation(employeeId, type, date) {
        if (type === 'start') {
            employees[employeeId].vacationStart = date ? new Date(date) : null;
        } else {
            employees[employeeId].vacationEnd = date ? new Date(date) : null;
        }
        updateCalendar();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è
    function toggleWeekend(employeeId, dayIndex, isChecked) {
        const weekends = employees[employeeId].weekends;
        if (isChecked) {
            if (!weekends.includes(dayIndex)) {
                weekends.push(dayIndex);
            }
        } else {
            const index = weekends.indexOf(dayIndex);
            if (index > -1) {
                weekends.splice(index, 1);
            }
        }
        updateCalendar();
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function removeEmployee(employeeId) {
        if (employees.length <= 1) {
            alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
            return;
        }

        employees.splice(employeeId, 1);
        // –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        for (let i = employeeId; i < employees.length; i++) {
            employees[i].id = i;
        }

        renderAllEmployees();
        updateCalendar();
    }

    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    function renderAllEmployees() {
        const container = document.getElementById('employees-container');
        container.innerHTML = '';

        employees.forEach((_, index) => {
            renderEmployeeSection(index);
        });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    function updateCalendar() {
        employees.forEach(employee => {
            renderCalendarForEmployee(employee);
        });
        updateSummary();
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function renderCalendarForEmployee(employee) {
        const calendarContainer = document.getElementById(`calendar-${employee.id}`);
        if (!calendarContainer) return;

        // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        calendarContainer.innerHTML = '';

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ (–Ω–∞—á–∏–Ω–∞—è —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞)
        weekdays.forEach(day => {
            const header = document.createElement('div');
            header.className = 'calendar-header';
            header.textContent = day;
            calendarContainer.appendChild(header);
        });

        // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        // –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –ø–µ—Ä–≤–æ–≥–æ —á–∏—Å–ª–∞ (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –∏ —Ç.–¥.)
        const firstDayOfWeek = firstDay.getDay();

        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
        // 0 (–≤—Å) -> 6, 1 (–ø–Ω) -> 0, 2 (–≤—Ç) -> 1, ..., 6 (—Å–±) -> 5
        const adjustedFirstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

        // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –¥–Ω–µ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        for (let i = 0; i < adjustedFirstDayOfWeek; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day';
            calendarContainer.appendChild(emptyDay);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —è—á–µ–π–∫–∏ –¥–ª—è –¥–Ω–µ–π –æ–∫—Ç—è–±—Ä—è
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const currentDate = new Date(year, month, day);
            const dayOfWeek = currentDate.getDay();

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (0=–ø–Ω, 1=–≤—Ç, ..., 6=–≤—Å)
            const adjustedDayOfWeek = dayOfWeek === 0 ? 6 : dayOfWeek - 1;

            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
            if (employee.weekends.includes(dayOfWeek)) {
                dayElement.classList.add('weekend');
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –¥–µ–Ω—å –≤ –æ—Ç–ø—É—Å–∫–µ
            if (isDateInVacation(currentDate, employee)) {
                dayElement.classList.add('vacation');
            } else if (!employee.weekends.includes(dayOfWeek)) {
                dayElement.classList.add('working');
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –¥–Ω—è –∏ —Å—Ç–∞—Ç—É—Å
            dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                    <div class="day-status">${getDayStatus(currentDate, employee)}</div>
                `;

            calendarContainer.appendChild(dayElement);
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –¥–∞—Ç–∞ –≤ –æ—Ç–ø—É—Å–∫–µ
    function isDateInVacation(date, employee) {
        if (!employee.vacationStart || !employee.vacationEnd) return false;

        const startDate = new Date(employee.vacationStart);
        const endDate = new Date(employee.vacationEnd);

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –≤ 00:00 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        startDate.setHours(0, 0, 0, 0);
        endDate.setHours(0, 0, 0, 0);
        date.setHours(0, 0, 0, 0);

        return date >= startDate && date <= endDate;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–Ω—è
    function getDayStatus(date, employee) {
        const dayOfWeek = date.getDay();

        if (employee.weekends.includes(dayOfWeek)) {
            return '–í—ã—Ö–æ–¥–Ω–æ–π';
        }

        if (isDateInVacation(date, employee)) {
            return '–û—Ç–ø—É—Å–∫';
        }

        return '–†–∞–±–æ—á–∏–π';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    function updateSummary() {
        const summaryContainer = document.getElementById('summary-content');
        if (!summaryContainer) return;

        const summary = employees.map(employee => {
            const stats = calculateEmployeeStats(employee);
            return `
                    <div class="summary-item">
                        <strong>${employee.name}:</strong>
                        –†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π: ${stats.workingDays},
                        –û—Ç–ø—É—Å–∫–Ω—ã—Ö –¥–Ω–µ–π: ${stats.vacationDays},
                        –í—ã—Ö–æ–¥–Ω—ã—Ö: ${stats.weekendDays}
                    </div>
                `;
        }).join('');

        summaryContainer.innerHTML = summary;
    }

    // –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function calculateEmployeeStats(employee) {
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        let workingDays = 0;
        let vacationDays = 0;
        let weekendDays = 0;

        for (let day = 1; day <= lastDay.getDate(); day++) {
            const currentDate = new Date(year, month, day);
            const dayOfWeek = currentDate.getDay();

            if (employee.weekends.includes(dayOfWeek)) {
                weekendDays++;
            } else if (isDateInVacation(currentDate, employee)) {
                vacationDays++;
            } else {
                workingDays++;
            }
        }

        return {workingDays, vacationDays, weekendDays};
    }
</script>


<script>
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
    document.querySelector('.overlay').addEventListener('click', function () {
        document.getElementById('burger-checkbox').checked = false;
    });
</script>


</body>
</html>